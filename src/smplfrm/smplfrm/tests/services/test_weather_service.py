
from django.test import TestCase

from open_meteo import Forecast, CurrentWeather, DailyForecastUnits, TimeFormat, DailyForecast, HourlyForecastUnits, HourlyForecast
from smplfrm.services import WeatherService
import datetime

class TestWeatherService(TestCase):
    def setUp(self):
        self.service = WeatherService()
        self.api_data = self.__returned_weather_data()



    def test_create_display_data(self):

        self.service.create(self.api_data)
        # assert data is stored in redis?
        data = self.service.read()
        self.assertEqual(self.api_data, data)

        test_now = datetime.datetime(2025, 2, 13, 5, 0, 0)
        display_data = self.service.get_for_display(now=test_now)

        current_temp = display_data['current_temp'].split(" ")[0]
        current_temp_unit = display_data['current_temp'].split(" ")[1]

        self.assertEqual(current_temp, '7.1')
        self.assertEqual(current_temp_unit, "°F")
        self.assertEqual('-5.3°F', display_data['current_low_temp'])
        self.assertEqual('14.4°F', display_data['current_high_temp'])

    def __returned_weather_data(self):
        return Forecast(elevation=836.0, generation_time_ms=0.0921487808227539, latitude=63.0, longitude=-147.375, utc_offset_seconds=0, current_weather=CurrentWeather(time=datetime.datetime(2025, 2, 13, 5, 15), temperature=6.4, wind_speed=3.2, wind_direction=309, weather_code=0), daily_units=DailyForecastUnits(apparent_temperature_max=None, apparent_temperature_min=None, precipitation_hours=None, precipitation_sum=None, shortwave_radiation_sum=None, sunrise=TimeFormat.ISO_8601, sunset=TimeFormat.ISO_8601, temperature_2m_max='°F', temperature_2m_min='°F', time=TimeFormat.ISO_8601, weather_code=None, wind_direction_10m_dominant=None, wind_gusts_10m_max=None, wind_speed_10m_max=None), daily=DailyForecast(time=[datetime.date(2025, 2, 13), datetime.date(2025, 2, 14), datetime.date(2025, 2, 15), datetime.date(2025, 2, 16), datetime.date(2025, 2, 17), datetime.date(2025, 2, 18), datetime.date(2025, 2, 19)], apparent_temperature_max=None, apparent_temperature_min=None, precipitation_hours=None, precipitation_sum=None, shortwave_radiation_sum=None, sunrise=[datetime.datetime(2025, 2, 13, 17, 43), datetime.datetime(2025, 2, 14, 17, 40), datetime.datetime(2025, 2, 15, 17, 37), datetime.datetime(2025, 2, 16, 17, 34), datetime.datetime(2025, 2, 17, 17, 30), datetime.datetime(2025, 2, 18, 17, 27), datetime.datetime(2025, 2, 19, 17, 24)], sunset=[datetime.datetime(2025, 2, 14, 2, 23), datetime.datetime(2025, 2, 15, 2, 26), datetime.datetime(2025, 2, 16, 2, 29), datetime.datetime(2025, 2, 17, 2, 32), datetime.datetime(2025, 2, 18, 2, 35), datetime.datetime(2025, 2, 19, 2, 38), datetime.datetime(2025, 2, 20, 2, 41)], temperature_2m_max=[14.4, 4.5, 18.2, 19.2, 15.8, 22.9, 25.2], temperature_2m_min=[-5.3, -3.6, 4.7, 9.0, 1.8, 11.0, 21.4], weathercode=None, wind_direction_10m_dominant=None, wind_gusts_10m_max=None, wind_speed_10m_max=None), hourly_units=HourlyForecastUnits(apparent_temperature=None, cloud_cover_high=None, cloud_cover_low=None, cloud_cover_mid=None, cloud_cover=None, dew_point_2m=None, diffuse_radiation=None, direct_normal_irradiance=None, direct_radiation=None, evapotranspiration=None, freezing_level_height=None, precipitation=None, pressure_msl=None, relative_humidity_2m='%', shortwave_radiation=None, snow_depth=None, soil_moisture_0_1cm=None, soil_moisture_1_3cm=None, soil_moisture_27_81cm=None, soil_moisture_3_9cm=None, soil_moisture_9_27cm=None, soil_temperature_0cm=None, soil_temperature_18cm=None, soil_temperature_54cm=None, soil_temperature_6cm=None, temperature_2m='°F', time=TimeFormat.ISO_8601, vapor_pressure_deficit=None, weather_code=None, wind_direction_10m=None, wind_direction_120m=None, wind_direction_180m=None, wind_direction_80m=None, wind_gusts_10m=None, wind_speed_10m=None, wind_speed_120m=None, wind_speed_180m=None, wind_speed_80m=None), hourly=HourlyForecast(time=[datetime.datetime(2025, 2, 13, 0, 0), datetime.datetime(2025, 2, 13, 1, 0), datetime.datetime(2025, 2, 13, 2, 0), datetime.datetime(2025, 2, 13, 3, 0), datetime.datetime(2025, 2, 13, 4, 0), datetime.datetime(2025, 2, 13, 5, 0), datetime.datetime(2025, 2, 13, 6, 0), datetime.datetime(2025, 2, 13, 7, 0), datetime.datetime(2025, 2, 13, 8, 0), datetime.datetime(2025, 2, 13, 9, 0), datetime.datetime(2025, 2, 13, 10, 0), datetime.datetime(2025, 2, 13, 11, 0), datetime.datetime(2025, 2, 13, 12, 0), datetime.datetime(2025, 2, 13, 13, 0), datetime.datetime(2025, 2, 13, 14, 0), datetime.datetime(2025, 2, 13, 15, 0), datetime.datetime(2025, 2, 13, 16, 0), datetime.datetime(2025, 2, 13, 17, 0), datetime.datetime(2025, 2, 13, 18, 0), datetime.datetime(2025, 2, 13, 19, 0), datetime.datetime(2025, 2, 13, 20, 0), datetime.datetime(2025, 2, 13, 21, 0), datetime.datetime(2025, 2, 13, 22, 0), datetime.datetime(2025, 2, 13, 23, 0), datetime.datetime(2025, 2, 14, 0, 0), datetime.datetime(2025, 2, 14, 1, 0), datetime.datetime(2025, 2, 14, 2, 0), datetime.datetime(2025, 2, 14, 3, 0), datetime.datetime(2025, 2, 14, 4, 0), datetime.datetime(2025, 2, 14, 5, 0), datetime.datetime(2025, 2, 14, 6, 0), datetime.datetime(2025, 2, 14, 7, 0), datetime.datetime(2025, 2, 14, 8, 0), datetime.datetime(2025, 2, 14, 9, 0), datetime.datetime(2025, 2, 14, 10, 0), datetime.datetime(2025, 2, 14, 11, 0), datetime.datetime(2025, 2, 14, 12, 0), datetime.datetime(2025, 2, 14, 13, 0), datetime.datetime(2025, 2, 14, 14, 0), datetime.datetime(2025, 2, 14, 15, 0), datetime.datetime(2025, 2, 14, 16, 0), datetime.datetime(2025, 2, 14, 17, 0), datetime.datetime(2025, 2, 14, 18, 0), datetime.datetime(2025, 2, 14, 19, 0), datetime.datetime(2025, 2, 14, 20, 0), datetime.datetime(2025, 2, 14, 21, 0), datetime.datetime(2025, 2, 14, 22, 0), datetime.datetime(2025, 2, 14, 23, 0), datetime.datetime(2025, 2, 15, 0, 0), datetime.datetime(2025, 2, 15, 1, 0), datetime.datetime(2025, 2, 15, 2, 0), datetime.datetime(2025, 2, 15, 3, 0), datetime.datetime(2025, 2, 15, 4, 0), datetime.datetime(2025, 2, 15, 5, 0), datetime.datetime(2025, 2, 15, 6, 0), datetime.datetime(2025, 2, 15, 7, 0), datetime.datetime(2025, 2, 15, 8, 0), datetime.datetime(2025, 2, 15, 9, 0), datetime.datetime(2025, 2, 15, 10, 0), datetime.datetime(2025, 2, 15, 11, 0), datetime.datetime(2025, 2, 15, 12, 0), datetime.datetime(2025, 2, 15, 13, 0), datetime.datetime(2025, 2, 15, 14, 0), datetime.datetime(2025, 2, 15, 15, 0), datetime.datetime(2025, 2, 15, 16, 0), datetime.datetime(2025, 2, 15, 17, 0), datetime.datetime(2025, 2, 15, 18, 0), datetime.datetime(2025, 2, 15, 19, 0), datetime.datetime(2025, 2, 15, 20, 0), datetime.datetime(2025, 2, 15, 21, 0), datetime.datetime(2025, 2, 15, 22, 0), datetime.datetime(2025, 2, 15, 23, 0), datetime.datetime(2025, 2, 16, 0, 0), datetime.datetime(2025, 2, 16, 1, 0), datetime.datetime(2025, 2, 16, 2, 0), datetime.datetime(2025, 2, 16, 3, 0), datetime.datetime(2025, 2, 16, 4, 0), datetime.datetime(2025, 2, 16, 5, 0), datetime.datetime(2025, 2, 16, 6, 0), datetime.datetime(2025, 2, 16, 7, 0), datetime.datetime(2025, 2, 16, 8, 0), datetime.datetime(2025, 2, 16, 9, 0), datetime.datetime(2025, 2, 16, 10, 0), datetime.datetime(2025, 2, 16, 11, 0), datetime.datetime(2025, 2, 16, 12, 0), datetime.datetime(2025, 2, 16, 13, 0), datetime.datetime(2025, 2, 16, 14, 0), datetime.datetime(2025, 2, 16, 15, 0), datetime.datetime(2025, 2, 16, 16, 0), datetime.datetime(2025, 2, 16, 17, 0), datetime.datetime(2025, 2, 16, 18, 0), datetime.datetime(2025, 2, 16, 19, 0), datetime.datetime(2025, 2, 16, 20, 0), datetime.datetime(2025, 2, 16, 21, 0), datetime.datetime(2025, 2, 16, 22, 0), datetime.datetime(2025, 2, 16, 23, 0), datetime.datetime(2025, 2, 17, 0, 0), datetime.datetime(2025, 2, 17, 1, 0), datetime.datetime(2025, 2, 17, 2, 0), datetime.datetime(2025, 2, 17, 3, 0), datetime.datetime(2025, 2, 17, 4, 0), datetime.datetime(2025, 2, 17, 5, 0), datetime.datetime(2025, 2, 17, 6, 0), datetime.datetime(2025, 2, 17, 7, 0), datetime.datetime(2025, 2, 17, 8, 0), datetime.datetime(2025, 2, 17, 9, 0), datetime.datetime(2025, 2, 17, 10, 0), datetime.datetime(2025, 2, 17, 11, 0), datetime.datetime(2025, 2, 17, 12, 0), datetime.datetime(2025, 2, 17, 13, 0), datetime.datetime(2025, 2, 17, 14, 0), datetime.datetime(2025, 2, 17, 15, 0), datetime.datetime(2025, 2, 17, 16, 0), datetime.datetime(2025, 2, 17, 17, 0), datetime.datetime(2025, 2, 17, 18, 0), datetime.datetime(2025, 2, 17, 19, 0), datetime.datetime(2025, 2, 17, 20, 0), datetime.datetime(2025, 2, 17, 21, 0), datetime.datetime(2025, 2, 17, 22, 0), datetime.datetime(2025, 2, 17, 23, 0), datetime.datetime(2025, 2, 18, 0, 0), datetime.datetime(2025, 2, 18, 1, 0), datetime.datetime(2025, 2, 18, 2, 0), datetime.datetime(2025, 2, 18, 3, 0), datetime.datetime(2025, 2, 18, 4, 0), datetime.datetime(2025, 2, 18, 5, 0), datetime.datetime(2025, 2, 18, 6, 0), datetime.datetime(2025, 2, 18, 7, 0), datetime.datetime(2025, 2, 18, 8, 0), datetime.datetime(2025, 2, 18, 9, 0), datetime.datetime(2025, 2, 18, 10, 0), datetime.datetime(2025, 2, 18, 11, 0), datetime.datetime(2025, 2, 18, 12, 0), datetime.datetime(2025, 2, 18, 13, 0), datetime.datetime(2025, 2, 18, 14, 0), datetime.datetime(2025, 2, 18, 15, 0), datetime.datetime(2025, 2, 18, 16, 0), datetime.datetime(2025, 2, 18, 17, 0), datetime.datetime(2025, 2, 18, 18, 0), datetime.datetime(2025, 2, 18, 19, 0), datetime.datetime(2025, 2, 18, 20, 0), datetime.datetime(2025, 2, 18, 21, 0), datetime.datetime(2025, 2, 18, 22, 0), datetime.datetime(2025, 2, 18, 23, 0), datetime.datetime(2025, 2, 19, 0, 0), datetime.datetime(2025, 2, 19, 1, 0), datetime.datetime(2025, 2, 19, 2, 0), datetime.datetime(2025, 2, 19, 3, 0), datetime.datetime(2025, 2, 19, 4, 0), datetime.datetime(2025, 2, 19, 5, 0), datetime.datetime(2025, 2, 19, 6, 0), datetime.datetime(2025, 2, 19, 7, 0), datetime.datetime(2025, 2, 19, 8, 0), datetime.datetime(2025, 2, 19, 9, 0), datetime.datetime(2025, 2, 19, 10, 0), datetime.datetime(2025, 2, 19, 11, 0), datetime.datetime(2025, 2, 19, 12, 0), datetime.datetime(2025, 2, 19, 13, 0), datetime.datetime(2025, 2, 19, 14, 0), datetime.datetime(2025, 2, 19, 15, 0), datetime.datetime(2025, 2, 19, 16, 0), datetime.datetime(2025, 2, 19, 17, 0), datetime.datetime(2025, 2, 19, 18, 0), datetime.datetime(2025, 2, 19, 19, 0), datetime.datetime(2025, 2, 19, 20, 0), datetime.datetime(2025, 2, 19, 21, 0), datetime.datetime(2025, 2, 19, 22, 0), datetime.datetime(2025, 2, 19, 23, 0)], apparent_temperature=None, cloud_cover_high=None, cloud_cover_low=None, cloud_cover_mid=None, cloud_cover=None, dew_point_2m=None, diffuse_radiation=None, direct_normal_irradiance=None, direct_radiation=None, evapotranspiration=None, freezing_level_height=None, precipitation=None, pressure_msl=None, relative_humidity_2m=[68, 68, 68, 67, 67, 68, 69, 71, 72, 73, 74, 74, 75, 75, 74, 74, 74, 74, 74, 74, 73, 73, 73, 72, 74, 77, 81, 83, 85, 85, 86, 85, 84, 83, 83, 82, 82, 82, 82, 83, 83, 83, 83, 83, 83, 83, 83, 83, 83, 83, 83, 83, 83, 83, 83, 82, 84, 85, 85, 85, 85, 84, 83, 82, 82, 81, 81, 79, 78, 77, 77, 74, 75, 79, 81, 80, 81, 81, 83, 85, 87, 88, 89, 89, 89, 90, 91, 91, 91, 90, 89, 87, 85, 83, 82, 82, 82, 83, 85, 86, 87, 88, 89, 90, 92, 94, 96, 98, 100, 100, 100, 100, 100, 100, 100, 100, 100, 99, 94, 87, 82, 81, 81, 81, 79, 75, 73, 72, 71, 71, 70, 70, 71, 76, 82, 87, 89, 90, 91, 91, 91, 91, 92, 92, 93, 94, 94, 95, 95, 95, 95, 94, 92, 90, 88, 87, 86, 87, 88, 89, 90, 90, 90, 90, 89, 88, 86, 84], shortwave_radiation=None, snow_depth=None, soil_moisture_0_1cm=None, soil_moisture_1_3cm=None, soil_moisture_27_81cm=None, soil_moisture_3_9cm=None, soil_moisture_9_27cm=None, soil_temperature_0cm=None, soil_temperature_18cm=None, soil_temperature_54cm=None, soil_temperature_6cm=None, temperature_2m=[13.5, 14.4, 13.6, 11.8, 9.5, 7.1, 4.8, 2.8, 1.4, 0.2, -0.9, -1.8, -2.5, -2.7, -3.1, -3.9, -4.9, -5.3, -5.2, -5.1, -3.6, -1.2, 1.6, 3.2, 4.3, 4.5, 3.6, 2.6, 1.8, 1.5, 0.9, 0.1, -0.7, -1.6, -2.7, -3.5, -3.6, -3.3, -2.9, -2.7, -2.4, -2.1, -1.8, -1.2, -0.3, 1.2, 2.8, 3.8, 4.7, 5.4, 5.9, 6.3, 6.5, 6.7, 7.1, 7.4, 7.5, 7.8, 8.2, 8.7, 9.0, 9.8, 10.4, 10.9, 11.6, 12.1, 12.6, 13.1, 14.0, 15.2, 17.0, 18.2, 18.9, 19.2, 18.9, 18.3, 17.5, 16.8, 15.8, 15.3, 15.1, 14.7, 14.2, 13.6, 13.0, 12.3, 11.4, 10.7, 10.0, 9.5, 9.1, 9.0, 9.0, 9.6, 11.5, 13.9, 15.6, 15.8, 15.2, 14.4, 13.5, 12.6, 11.7, 10.8, 9.9, 9.0, 8.1, 7.0, 5.9, 4.9, 3.9, 3.1, 2.5, 1.9, 1.8, 1.8, 2.1, 3.2, 5.5, 8.7, 11.0, 12.0, 12.3, 12.6, 13.0, 13.5, 14.0, 14.4, 14.9, 15.3, 15.6, 16.0, 16.2, 16.2, 16.0, 16.0, 16.2, 16.7, 17.3, 18.0, 18.9, 20.0, 21.4, 22.9, 24.0, 24.4, 24.5, 24.5, 24.6, 24.6, 24.7, 24.9, 25.1, 25.2, 25.2, 25.2, 24.9, 24.3, 23.6, 22.9, 22.3, 21.7, 21.5, 21.4, 21.6, 22.0, 23.0, 24.3], vapor_pressure_deficit=None, weather_code=None, wind_direction_10m=None, wind_direction_120m=None, wind_direction_180m=None, wind_direction_80m=None, wind_gusts_10m=None, wind_speed_10m=None, wind_speed_120m=None, wind_speed_180m=None, wind_speed_80m=None))